---
import Layout from '@/layouts/main.astro';
import { learningTracks, getCourse, withBase } from '@/lib/curriculum';

export function getStaticPaths() {
  return learningTracks.flatMap((track) =>
    track.courses.map((course) => ({
      params: {
        track: track.slug,
        course: course.slug,
      },
    }))
  );
}

const { track: trackSlug, course: courseSlug } = Astro.params;
const context = trackSlug && courseSlug ? getCourse(trackSlug, courseSlug) : null;

if (!context) {
  throw new Error('Curso no encontrado.');
}

const { track, course } = context;
const firstModule = course.modules[0];
const firstLesson = firstModule?.lessons[0];
const startHref = firstModule && firstLesson
  ? withBase(`/cursos/${track.slug}/${course.slug}/${firstModule.slug}/${firstLesson.slug}`)
  : withBase(`/cursos/${track.slug}/${course.slug}`);
---

<Layout title={`${course.title} | Hekademos IT`}>
  <section class="py-16 md:py-24">
    <div class="container mx-auto px-4">
      <div class="rounded-3xl border bg-card p-8 md:p-10">
        <p class="text-sm uppercase tracking-wide text-muted-foreground">{track.title}</p>
        <h1 class="mt-2 text-3xl font-bold md:text-5xl">{course.title}</h1>
        <p class="mt-4 max-w-3xl text-muted-foreground">{course.summary}</p>

        <div class="mt-6 flex flex-wrap gap-3">
          <span class="rounded-full bg-secondary px-3 py-1 text-sm font-medium text-secondary-foreground">
            Nivel: {course.level}
          </span>
          <span class="rounded-full bg-secondary px-3 py-1 text-sm font-medium text-secondary-foreground">
            {course.estimatedHours} horas estimadas
          </span>
          <span class="rounded-full bg-secondary px-3 py-1 text-sm font-medium text-secondary-foreground">
            {course.modules.length} modulos
          </span>
        </div>

        <div class="mt-8">
          <a href={startHref} class="inline-flex rounded-lg bg-primary px-5 py-3 text-sm font-semibold text-primary-foreground hover:opacity-90">
            Iniciar curso
          </a>
        </div>
      </div>

      <div class="mt-10 grid gap-6">
        {course.modules.map((module, moduleIndex) => (
          <article class="rounded-2xl border bg-card p-6" key={module.slug}>
            <p class="text-sm text-muted-foreground">Modulo {moduleIndex + 1}</p>
            <h2 class="mt-1 text-2xl font-semibold">{module.title}</h2>
            <p class="mt-2 text-muted-foreground">{module.summary}</p>

            <ul class="mt-4 space-y-2">
              {module.lessons.map((lesson, lessonIndex) => (
                <li class="flex items-center justify-between rounded-lg border px-4 py-3" key={lesson.slug}>
                  <div>
                    <p class="text-sm text-muted-foreground">Leccion {lessonIndex + 1}</p>
                    <p class="font-medium">{lesson.title}</p>
                  </div>
                  <a
                    href={withBase(`/cursos/${track.slug}/${course.slug}/${module.slug}/${lesson.slug}`)}
                    class="text-sm font-medium text-primary hover:underline"
                  >
                    Abrir
                  </a>
                </li>
              ))}
            </ul>
          </article>
        ))}
      </div>
    </div>
  </section>
</Layout>
